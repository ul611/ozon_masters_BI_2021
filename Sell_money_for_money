Задание.
Вы – начинающий аналитик в команде финтех-продуктов компании Озон. 
Ваш первый проект – продукт «Кешбек за деньги». 
Смысл продукта заключается в том, чтобы предложить клиенту купить повышенный кэшбек на выбранные им категории товаров. 

Пример:
У Вани есть карта Озон. При любой покупке с карты Озон, Ваня получает 5% от суммы покупки баллами назад на карту. Баллы можно потратить только при покупке в Озон. 
Ваня также может заплатить X рублей и приобрести повышенный кешбек в категории «Электроника». После покупки в течение месяца Ваня в категории «Электроника» будет получать кэшбек 5+Y%, но не более Z рублей суммарно. Величины X, Y и Z могут быть отличаться в зависимости от категории.

Вашей задачей является:
    • разработка методологии расчета параметров продукта (величин X, Y и Z)
    • построение экономической модели продукта + proof of concept
    • построение методологии тестирования продукта

При этом в последнюю минуту руководитель сказал, что продукт должен быть безубыточен.

Решение.
Если мы предполагаем, что 5% -й кэшбек безубыточен компании, то рассчитать показатели можно следующим образом.
Примем размер трат Вани в месяц на определенную категорию за М.
Тогда 
5 * М / 100 — это стандартный безубыточный для компании кэшбек Вани в месяц на определенную категорию.
Мы предлагаем Ване новый кэшбек в размере (5 + Y) * M / 100.
Допустим, что в среднем Вани будут стараться потратить в этой категории в текущем месяце не меньше денег, чем вложили в доплату (Х =  Y * M / 100).
В предположении, что Ваня тратит каждый месяц одну и ту же сумму М, из которых в виде стандартного кэшбека за предыдущий месяц он оплачивает 5%, новых денег Ваня приносит 0.95 * М. 
На первый взгляд, чтобы продукт был безубыточен для компании, максимальный кэшбек Z должен быть не больше (5 * M / 100) + Х.
С другой стороны, Ваня до программы тратил только М рублей в месяц, а с программой мы стимулируем его тратить не меньше М_new = (100 * X / Y)
Наш интерес — найти такое X, чтобы Ваня потратил денег больше, чем планировал потратить в этой категории. То есть хорошей отправной точкой для категории со стабильными тратами и небольшим стандартным отклонением можно считать медианную трату в категории М за предыдущие несколько месяцев (в непопулярной категории, соответственно траты могут быть нестабильными от месяца к месяцу с большим стандартным отклонением, тогда стоит взять значение другого, более высокого квартиля)  M_q. 
Таким образом, значения для всех трех показателей рассчитаем исходя из:
1) М_new = M_q + delta, где за delta возьмем минимум между (M_max — M_q), где M_max - максимальная трата за предыдущие месяцы, и 0.2 * M_q. Можно также оценить среднее по общим тратам Вани за месяц и также использовать для расчета delta
2) X можно рассчитать исходя из среднего чека Вани в повседневных тратах. То есть сумма для Вани не должна быть значительной. Допустим, это будет сумма М_q / (days * n_purchase), где days — среднее количество дней в месяце, n_purchase — среднее количество повседневных трат.
Получаем достаточное количество данных для расчета всех трех показателей при посчитанных по ретроданным переменных  М_q и M_max:
delta = min(M_max — M_q, 0.2 * M_q)
М_new = M_q + delta
Х = round(М_new / ( days * n_purchase)) округляем с точностью до 10 рублей (но не меньше 10 рублей)
Y = round(100 * X / M_new) округляем с точностью до 1% вверх (но не меньше 1%)
Z = round((5 + Y / 100) * X * days * n_purchase) округляем с точностью до 10 рублей вниз (но не меньше 10 рублей)
здесь  X * days * n_purchase — пересчет  M_new.



